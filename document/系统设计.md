# 系统设计
信息系统，主要用于技术知识积累，个人信息管理，辅助进行智能家居的信息管理。
* 文件（及大文件）另行管理

## 1. 设计原则
### 1. 信息入口单一
>比如配置文件， 可能很多地方都需要使用配置文件， 如果每个使用的地方都去加载配置文件，那么以后配置文件有修改（比如配置文件名称，实现方式），就需要修改所有使用到配置文件的地方，这很可能因为漏掉某些地方而导致系统不正常运行

定义好配置文件的数据接口，在唯一的地方引入配置文件数据，其他使用到配置数据的地方都使用参数传入。

### 2. 系统备份
备份的数据包括：数据库文件，配置文件(.env), 证书文件； 导出部分静态文件。
>项目代码在github上，不需要备份。


## 1. 框架设计
在核心部分实现模块加载框架， 子网站功能实现固定的接口。涉及的问题有：
1. 数据库的初始化， 及数据模型的加载
2. 静态文件服务的初始化
3. 路由的加载
4. 控制器的加载

数据库(包括数据模型)/资源文件(静态文件)/路由/控制器是相对独立的。
子网站的目录要求： 
~~~
+ /websysX/
|-+ websites/
  |-+ tag/
    |- model/
    |- control/
    |- route/
    |- view/
~~~

### 1.1 数据库初始化及数据模型的加载
数据库初始化完成以后才能进行数据模型的加载，所有数据模型加载完成后，才进行关系的加载。
完成初始化后的sequelize句柄存储为ctx.sequelize, 加载的数据模型存储在ctx.models[]中， 模型在数组中的键值即为模型的名称。

数据模型存放在model/目录下，一个数据表一个文件，以驼峰法名称， 首字母大写。

数据关系存放在Relation.js文件中，该文件导出一个`link()`方法。多对多关系的表名称命名方法是：主体模型名称在前，比如文档和标签关系的数据表名称为：`DocumentTag`

注意： 由于各个子网站的加载顺序不确定，所以先要将所有的数据模型加载完成后， 再加载数据关系。


### 1.2 控制器的加载
控制器存放在control/目录下， 加载的控制器存放在ctx.controls[]中， 控制器的价值采用类似命名空间的方法， 第1部分为子网站名称，第2部分为控制器文件的名称， 比如ctx.controls['tag/tag']

### 1.3 路由的加载
路由存放在route/目录下。 
路由加载时， 子网站的名称将作为路由的第1部分， 路由的文件名称作为路由的第2部分，路由函数中的路径将追加到后面。比如/websysX/websites/document/route/tag.js中的路由方法路径为/document/tag/*。如果是index.js中的方法，将没有第2部分路径。


## 2. 用户系统
普通用户：登录，修改密码
管理员：  添加/编辑用户

### 2.1 权限系统
系统只允许登录用户访问。
资源分为2种：
* 共享资源， 所有登录用户可创建/访问， 资源创建者可编辑/删除； 
* 私有资源， 所有登录用户可创建， 资源创建者可访问/编辑/删除

超级管理员可以查看/删除任何资源，但不能编辑。
资源的类型由模块的实现决定，比如文档资源都是共享资源，个人信息资源即为私有资源。


## 3. 应用设计

### 3.1 目录管理
目录管理类似专题， 只管理文档。  

每个用户都可以添加子节点， 但只有管理员才能删除。 因为当前用户创建的节点下面可能有其他用户创建的字节点。

### 3.2 芯片功能
功能说明的实现
* 编辑： 选择模块， 选择多个模块内的位组， 编辑功能说明
* 浏览（index）： 列出所有功能， 通过checkbox选择单个或多个功能（标注功能的位组）， 显示最后一个选中功能的说明（滚动）

文章编辑功能：将芯片，芯片/模块作为标签。 只提供前端页面，后端使用文档功能